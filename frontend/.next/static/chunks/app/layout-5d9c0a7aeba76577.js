(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4823:function(e,t,r){Promise.resolve().then(r.t.bind(r,7960,23)),Promise.resolve().then(r.bind(r,624)),Promise.resolve().then(r.bind(r,3119)),Promise.resolve().then(r.bind(r,575))},624:function(e,t,r){"use strict";r.d(t,{default:function(){return l}});var s=r(7437),a=r(3427),o=r(9827);r(2265);let n=new a.S;function l(e){let{children:t}=e;return(0,s.jsx)(o.aH,{client:n,children:t})}},3119:function(e,t,r){"use strict";r.d(t,{default:function(){return i}});var s=r(7437);r(2265);var a=r(7648),o=r(9376),n=r(575);let l=[{label:"Dashboard",href:"/dashboard",icon:"\uD83D\uDCCA",roles:[]},{label:"Employees",href:"/employees",icon:"\uD83D\uDC65",roles:["super_admin","HR"]},{label:"Attendance",href:"/attendance",icon:"â°",roles:["super_admin","HR"]},{label:"Announcements",href:"/announcements",icon:"\uD83D\uDCE2",roles:["super_admin","HR"]},{label:"Documents",href:"/documents",icon:"\uD83D\uDCC1",roles:["super_admin","HR"]},{label:"Activity Logs",href:"/activity-logs",icon:"\uD83D\uDCDD",roles:["super_admin","HR"]},{label:"Company Revenue",href:"/company-revenue",icon:"\uD83D\uDCB0",roles:["super_admin","accountant"]},{label:"Cash Flow",href:"/cash-flow",icon:"\uD83D\uDCB5",roles:["super_admin","accountant"]},{label:"Financial Statements",href:"/financial-statements",icon:"\uD83D\uDCC8",roles:["super_admin","accountant"]},{label:"Purchase Requests",href:"/purchase-requests",icon:"\uD83D\uDED2",roles:["super_admin","accountant"]},{label:"Suppliers",href:"/suppliers",icon:"\uD83C\uDFE2",roles:["super_admin","accountant"]},{label:"Annual Expenses",href:"/annual-expenses",icon:"\uD83D\uDCB8",roles:["super_admin","accountant"]},{label:"Payroll Reports",href:"/payroll-reports",icon:"\uD83D\uDCBC",roles:["super_admin","accountant"]}];function i(){var e,t,r,i;let{user:u,logout:d}=(0,n.a)(),c=(0,o.usePathname)(),h=(null==u?void 0:null===(e=u.role)||void 0===e?void 0:e.toLowerCase())||"";return(0,s.jsxs)("aside",{className:"w-72 bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 h-screen flex flex-col shadow-2xl border-r border-slate-700/50",children:[(0,s.jsx)("div",{className:"p-6 border-b border-slate-700/50",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,s.jsx)("span",{className:"text-white text-xl font-bold",children:"\uD83C\uDFE2"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-bold bg-gradient-to-r from-white to-blue-200 bg-clip-text text-transparent",children:"Company Portal"}),(0,s.jsx)("p",{className:"text-xs text-slate-400",children:"Management System"})]})]})}),(0,s.jsx)("div",{className:"px-4 py-4 border-b border-slate-700/50",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3 px-3 py-2 rounded-lg bg-slate-800/50",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold shadow-lg",children:(null==u?void 0:null===(r=u.email)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.toUpperCase())||"U"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-white truncate",children:null==u?void 0:u.email}),(0,s.jsx)("p",{className:"text-xs text-blue-400 font-medium capitalize",children:null==u?void 0:null===(i=u.role)||void 0===i?void 0:i.replace("_"," ")})]})]})}),(0,s.jsx)("nav",{className:"flex-1 overflow-y-auto p-4 space-y-1 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:l.filter(e=>!e.roles.length||e.roles.includes(h)).map(e=>{let t=c===e.href||(null==c?void 0:c.startsWith(e.href+"/"));return(0,s.jsxs)(a.default,{href:e.href,className:"\n                  group flex items-center space-x-3 px-4 py-3 rounded-xl\n                  transition-all duration-300 transform\n                  ".concat(t?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/50 scale-[1.02]":"text-slate-300 hover:bg-slate-800/50 hover:text-white hover:translate-x-1","\n                "),children:[(0,s.jsx)("span",{className:"text-xl group-hover:scale-110 transition-transform duration-300",children:e.icon}),(0,s.jsx)("span",{className:"font-medium text-sm",children:e.label}),t&&(0,s.jsx)("div",{className:"ml-auto w-2 h-2 bg-white rounded-full animate-pulse"})]},e.href)})}),(0,s.jsx)("div",{className:"p-4 border-t border-slate-700/50",children:(0,s.jsxs)("button",{onClick:d,className:"w-full flex items-center justify-center space-x-2 px-4 py-3  bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white rounded-xl font-semibold shadow-lg shadow-red-500/50 hover:shadow-red-600/50 transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98]",children:[(0,s.jsx)("span",{children:"\uD83D\uDEAA"}),(0,s.jsx)("span",{children:"Logout"})]})})]})}},575:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return i},a:function(){return u}});var s=r(7437),a=r(2265),o=r(9116),n=r(9376);let l=(0,a.createContext)(void 0),i=e=>{let{children:t}=e,[r,i]=(0,a.useState)(null),[u,d]=(0,a.useState)(null),[c,h]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null),f=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&i(e),t&&d(JSON.parse(t))},[]);let v=async(e,t)=>{h(!0),m(null);let r=e.trim();try{let e=await o.Z.post("/auth/login",{email:r,password:t});if(e.data.requiresOtp)return{requiresOtp:!0};if(e.data.access_token&&e.data.user)return i(e.data.access_token),d(e.data.user),localStorage.setItem("token",e.data.access_token),localStorage.setItem("user",JSON.stringify(e.data.user)),{access_token:e.data.access_token,user:e.data.user};return m("Invalid response from server."),{}}catch(e){var s,a,n,l,u,c,p,f,v,g,x,b;if(console.log("[Auth] Login error status:",null===(s=e.response)||void 0===s?void 0:s.status),console.log("[Auth] Login error data:",null===(a=e.response)||void 0===a?void 0:a.data),(null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.locked)===!0&&(null===(c=e.response)||void 0===c?void 0:null===(u=c.data)||void 0===u?void 0:u.email))return console.log("[Auth] OTP required (account locked)"),{requiresOtp:!0,email:e.response.data.email};if((null===(f=e.response)||void 0===f?void 0:null===(p=f.data)||void 0===p?void 0:p.suspended)===!0)return m((null===(b=e.response)||void 0===b?void 0:null===(x=b.data)||void 0===x?void 0:x.message)||"Your account has been suspended. Please contact an administrator."),{};return m((null===(g=e.response)||void 0===g?void 0:null===(v=g.data)||void 0===v?void 0:v.message)||"Login failed"),{}}finally{h(!1)}},g=async e=>{h(!0),m(null),console.log("[Auth] Requesting OTP for forgot password:",e);try{let t=await o.Z.post("/auth/forgot-password",{email:e});return console.log("[Auth] Forgot password response:",t.data),!0}catch(e){var t,r;return m((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"Failed to request password reset OTP"),console.error("[Auth] Forgot password error:",e),!1}finally{h(!1)}},x=async(e,t)=>{h(!0),m(null),console.log("[Auth] Attempting OTP verification for email:",e);try{let r=await o.Z.post("/auth/verify-otp",{email:e,otp:t});if(console.log("[Auth] Response from /auth/verify-otp:",r.data),r.data.otp_reset)return console.log("[Auth] OTP verified, got otp_reset:",r.data.otp_reset),{otp_reset:r.data.otp_reset,type:"reset"};if(r.data.access_token&&r.data.user)return i(r.data.access_token),d(r.data.user),localStorage.setItem("token",r.data.access_token),localStorage.setItem("user",JSON.stringify(r.data.user)),{access_token:r.data.access_token,user:r.data.user,type:"mfa"};return m("Invalid OTP or response."),!1}catch(e){var r,s;return m((null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"OTP verification failed"),!1}finally{h(!1)}},b=async(e,t,r,s)=>{h(!0),m(null);try{let a=await o.Z.post("/auth/reset-password",{email:e,otp_reset:t,newPassword:r,confirmPassword:s});return console.log("[Auth] Password reset response:",a.data),!0}catch(e){var a,n;return m((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Password reset failed"),console.error("[Auth] Password reset error:",e),!1}finally{h(!1)}};return(0,s.jsx)(l.Provider,{value:{token:r,user:u,loading:c,error:p,login:v,forgotPassword:g,verifyOtp:x,logout:()=>{console.log("[Auth] Logging out user"),i(null),d(null),localStorage.removeItem("token"),localStorage.removeItem("user"),f.push("/login")},resetPassword:b},children:t})},u=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9116:function(e,t,r){"use strict";let s=r(3464).Z.create({baseURL:"http://47.128.68.111:3000",withCredentials:!0,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t))}catch(e){console.warn("[API] Failed to read token from localStorage:",e)}return e}),s.interceptors.response.use(e=>e,e=>Promise.reject(e)),t.Z=s},7960:function(){}},function(e){e.O(0,[587,301,19,971,117,744],function(){return e(e.s=4823)}),_N_E=e.O()}]);