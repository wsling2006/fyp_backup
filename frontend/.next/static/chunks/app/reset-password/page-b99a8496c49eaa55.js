(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[363],{6425:function(e,t,s){Promise.resolve().then(s.bind(s,878))},878:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m},dynamic:function(){return d}});var r=s(7437),a=s(2265),o=s(9376),n=s(575),l=s(8068),i=s(4226),c=s(1154);let d="force-dynamic";function u(){let{resetPassword:e,loading:t,error:s}=(0,n.a)(),d=(0,o.useSearchParams)(),u=(0,o.useRouter)(),[m,g]=(0,a.useState)(""),[h,f]=(0,a.useState)(""),[p,v]=(0,a.useState)(""),[x,b]=(0,a.useState)(""),[w,y]=(0,a.useState)(null),j=p.length>=8,N=/[A-Z]/.test(p),P=/[a-z]/.test(p),A=/[0-9]/.test(p),S=/[^A-Za-z0-9]/.test(p),k=x.length>0&&p===x;(0,a.useEffect)(()=>{let e=d.get("email"),t=d.get("otp_reset");if(t||(t=sessionStorage.getItem("resetOtp")),!e||!t){y("OTP not requested. Please retry the process.");return}g(e),f(t)},[d]);let _=async t=>{if(t.preventDefault(),y(null),!h){y("OTP missing. Cannot reset password.");return}let s=p.length<8?"Password must be at least 8 characters.":/[A-Z]/.test(p)?/[a-z]/.test(p)?/[0-9]/.test(p)?/[^A-Za-z0-9]/.test(p)?null:"Password must contain a special character.":"Password must contain a number.":"Password must contain a lowercase letter.":"Password must contain an uppercase letter.";if(s){y(s);return}if(p!==x){y("Passwords do not match.");return}await e(m,h,p,x)&&(sessionStorage.removeItem("resetOtp"),u.push("/login?reset=success"))};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("form",{onSubmit:_,className:"bg-white p-8 rounded-lg shadow w-full max-w-md",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Reset Password"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Your new password must meet all the following requirements:"}),(0,r.jsxs)("ul",{className:"text-sm mb-6 list-disc list-inside space-y-1",children:[(0,r.jsxs)("li",{className:"flex items-center ".concat(j?"text-green-600":"text-gray-600"),children:[(0,r.jsx)("span",{className:"mr-2",children:j?"✓":"✗"})," At least 8 characters"]}),(0,r.jsxs)("li",{className:"flex items-center ".concat(N?"text-green-600":"text-gray-600"),children:[(0,r.jsx)("span",{className:"mr-2",children:N?"✓":"✗"})," At least 1 uppercase letter (A-Z)"]}),(0,r.jsxs)("li",{className:"flex items-center ".concat(P?"text-green-600":"text-gray-600"),children:[(0,r.jsx)("span",{className:"mr-2",children:P?"✓":"✗"})," At least 1 lowercase letter (a-z)"]}),(0,r.jsxs)("li",{className:"flex items-center ".concat(A?"text-green-600":"text-gray-600"),children:[(0,r.jsx)("span",{className:"mr-2",children:A?"✓":"✗"})," At least 1 number (0-9)"]}),(0,r.jsxs)("li",{className:"flex items-center ".concat(S?"text-green-600":"text-gray-600"),children:[(0,r.jsx)("span",{className:"mr-2",children:S?"✓":"✗"})," At least 1 special character (!@#$%^&* etc.)"]}),(0,r.jsxs)("li",{className:"flex items-center ".concat(k?"text-green-600":"text-gray-600"),children:[(0,r.jsx)("span",{className:"mr-2",children:k?"✓":"✗"})," Passwords match"]})]}),w&&(0,r.jsx)("div",{className:"text-red-500 mb-4",children:w}),s&&(0,r.jsx)("div",{className:"text-red-500 mb-4",children:s}),(0,r.jsx)(l.Z,{type:"password",placeholder:"New Password",value:p,onChange:e=>v(e.target.value),required:!0,className:"mb-2"}),(0,r.jsx)(l.Z,{type:"password",placeholder:"Confirm Password",value:x,onChange:e=>b(e.target.value),required:!0,className:"mb-4"}),(0,r.jsx)(i.Z,{type:"submit",disabled:t||!(j&&N&&P&&A&&S&&k),className:"w-full",children:t?(0,r.jsx)(c.Z,{}):"Reset Password"})]})})}function m(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)(c.Z,{})}),children:(0,r.jsx)(u,{})})}},4226:function(e,t,s){"use strict";var r=s(7437);s(2265),t.Z=e=>{let{className:t="",variant:s="primary",children:a,...o}=e;return(0,r.jsx)("button",{className:"\n        ".concat({primary:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/50 hover:shadow-blue-600/50",secondary:"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white shadow-lg shadow-gray-500/50",danger:"bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white shadow-lg shadow-red-500/50",success:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg shadow-green-500/50",outline:"bg-transparent border-2 border-blue-600 text-blue-600 hover:bg-blue-50 shadow-none"}[s],"\n        rounded-xl px-6 py-3 w-full font-semibold\n        transition-all duration-300 \n        transform hover:scale-[1.02] active:scale-[0.98]\n        disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\n        focus:outline-none focus:ring-4 focus:ring-blue-500/50\n        ").concat(t,"\n      "),...o,children:a})}},8068:function(e,t,s){"use strict";var r=s(7437);s(2265),t.Z=e=>{let{className:t="",label:s,error:a,icon:o,labelClassName:n,...l}=e;return(0,r.jsxs)("div",{className:"w-full",children:[s&&(0,r.jsx)("label",{className:n||"block text-sm font-semibold text-gray-700 mb-2",children:s}),(0,r.jsxs)("div",{className:"relative",children:[o&&(0,r.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",children:o}),(0,r.jsx)("input",{className:"\n            bg-white border-2 border-gray-200 text-gray-900 \n            rounded-xl px-4 py-3 w-full\n            ".concat(o?"pl-12":"","\n            focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20\n            hover:border-gray-300\n            transition-all duration-300\n            placeholder:text-gray-400\n            disabled:bg-gray-50 disabled:cursor-not-allowed\n            ").concat(a?"border-red-500 focus:border-red-500 focus:ring-red-500/20":"","\n            ").concat(t,"\n          "),...l})]}),a&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600 font-medium",children:a})]})}},1154:function(e,t,s){"use strict";var r=s(7437);s(2265),t.Z=function(){return(0,r.jsx)("div",{className:"flex justify-center items-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"})})}},575:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return i},a:function(){return c}});var r=s(7437),a=s(2265),o=s(9116),n=s(9376);let l=(0,a.createContext)(void 0),i=e=>{let{children:t}=e,[s,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[u,m]=(0,a.useState)(!1),[g,h]=(0,a.useState)(null),f=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&i(e),t&&d(JSON.parse(t))},[]);let p=async(e,t)=>{m(!0),h(null);let s=e.trim();try{let e=await o.Z.post("/auth/login",{email:s,password:t});if(e.data.requiresOtp)return{requiresOtp:!0};if(e.data.access_token&&e.data.user)return i(e.data.access_token),d(e.data.user),localStorage.setItem("token",e.data.access_token),localStorage.setItem("user",JSON.stringify(e.data.user)),{access_token:e.data.access_token,user:e.data.user};return h("Invalid response from server."),{}}catch(e){var r,a,n,l,c,u,g,f,p,v,x,b;if(console.log("[Auth] Login error status:",null===(r=e.response)||void 0===r?void 0:r.status),console.log("[Auth] Login error data:",null===(a=e.response)||void 0===a?void 0:a.data),(null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.locked)===!0&&(null===(u=e.response)||void 0===u?void 0:null===(c=u.data)||void 0===c?void 0:c.email))return console.log("[Auth] OTP required (account locked)"),{requiresOtp:!0,email:e.response.data.email};if((null===(f=e.response)||void 0===f?void 0:null===(g=f.data)||void 0===g?void 0:g.suspended)===!0)return h((null===(b=e.response)||void 0===b?void 0:null===(x=b.data)||void 0===x?void 0:x.message)||"Your account has been suspended. Please contact an administrator."),{};return h((null===(v=e.response)||void 0===v?void 0:null===(p=v.data)||void 0===p?void 0:p.message)||"Login failed"),{}}finally{m(!1)}},v=async e=>{m(!0),h(null),console.log("[Auth] Requesting OTP for forgot password:",e);try{let t=await o.Z.post("/auth/forgot-password",{email:e});return console.log("[Auth] Forgot password response:",t.data),!0}catch(e){var t,s;return h((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to request password reset OTP"),console.error("[Auth] Forgot password error:",e),!1}finally{m(!1)}},x=async(e,t)=>{m(!0),h(null),console.log("[Auth] Attempting OTP verification for email:",e);try{let s=await o.Z.post("/auth/verify-otp",{email:e,otp:t});if(console.log("[Auth] Response from /auth/verify-otp:",s.data),s.data.otp_reset)return console.log("[Auth] OTP verified, got otp_reset:",s.data.otp_reset),{otp_reset:s.data.otp_reset,type:"reset"};if(s.data.access_token&&s.data.user)return i(s.data.access_token),d(s.data.user),localStorage.setItem("token",s.data.access_token),localStorage.setItem("user",JSON.stringify(s.data.user)),{access_token:s.data.access_token,user:s.data.user,type:"mfa"};return h("Invalid OTP or response."),!1}catch(e){var s,r;return h((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.message)||"OTP verification failed"),!1}finally{m(!1)}},b=async(e,t,s,r)=>{m(!0),h(null);try{let a=await o.Z.post("/auth/reset-password",{email:e,otp_reset:t,newPassword:s,confirmPassword:r});return console.log("[Auth] Password reset response:",a.data),!0}catch(e){var a,n;return h((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Password reset failed"),console.error("[Auth] Password reset error:",e),!1}finally{m(!1)}};return(0,r.jsx)(l.Provider,{value:{token:s,user:c,loading:u,error:g,login:p,forgotPassword:v,verifyOtp:x,logout:()=>{console.log("[Auth] Logging out user"),i(null),d(null),localStorage.removeItem("token"),localStorage.removeItem("user"),f.push("/login")},resetPassword:b},children:t})},c=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9116:function(e,t,s){"use strict";let r=s(3464).Z.create({baseURL:"http://47.128.68.111:3000",withCredentials:!0,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t))}catch(e){console.warn("[API] Failed to read token from localStorage:",e)}return e}),r.interceptors.response.use(e=>e,e=>Promise.reject(e)),t.Z=r}},function(e){e.O(0,[301,971,117,744],function(){return e(e.s=6425)}),_N_E=e.O()}]);