â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         HR UPLOAD FIX - CORRECT DATABASE MIGRATION COMMANDS                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” CORRECT DATABASE CREDENTIALS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Database: fyp_db
Username: fyp_user
Password: GL5jYNDqsOVkx6tIfIS2eUonM
Host:     localhost
Port:     5432


ğŸš€ MIGRATION COMMANDS (Choose One Method)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

METHOD 1: Run Migration SQL File (Recommended)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
cd /home/ubuntu/fyp_system/backend

PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db -f migrations/add_document_types_to_enum.sql


METHOD 2: Interactive psql Session
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db

-- Then paste these commands:
ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'EMPLOYMENT_AGREEMENT';
ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'CERTIFICATION';
ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'PERFORMANCE_REVIEW';

-- Exit when done:
\q


METHOD 3: One-Line Command
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db -c "ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'EMPLOYMENT_AGREEMENT'; ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'CERTIFICATION'; ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'PERFORMANCE_REVIEW';"


âœ… VERIFY MIGRATION SUCCESS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db -c "SELECT unnest(enum_range(NULL::employee_documents_document_type_enum));"

Expected output (8 values):
              unnest              
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 RESUME
 EMPLOYMENT_CONTRACT
 OFFER_LETTER
 IDENTITY_DOCUMENT
 OTHER
 EMPLOYMENT_AGREEMENT    â† NEW
 CERTIFICATION           â† NEW
 PERFORMANCE_REVIEW      â† NEW
(8 rows)


ğŸ“‹ COMPLETE DEPLOYMENT SEQUENCE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# Step 1: SSH to EC2
ssh -i /path/to/key.pem ubuntu@YOUR_EC2_IP

# Step 2: Pull latest code
cd /home/ubuntu/fyp_system
git pull origin main

# Step 3: Run database migration âš ï¸ CRITICAL
cd backend
PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db -f migrations/add_document_types_to_enum.sql

# Step 4: Verify migration
PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db -c "SELECT unnest(enum_range(NULL::employee_documents_document_type_enum));"

# Step 5: Rebuild backend
npm run build

# Step 6: Restart backend
cd ..
pm2 restart backend

# Step 7: Check status
pm2 status

# Step 8: Watch logs
pm2 logs backend --lines 0


ğŸ” QUICK CHECK (Before Migration)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# See current enum values (should show only 5):
PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db -c "SELECT unnest(enum_range(NULL::employee_documents_document_type_enum));"


ğŸ” QUICK CHECK (After Migration)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# See updated enum values (should show 8):
PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db -c "SELECT unnest(enum_range(NULL::employee_documents_document_type_enum));"


âŒ TROUBLESHOOTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Error: "Peer authentication failed"
Fix: Use PGPASSWORD environment variable (as shown above)

Error: "database 'fyp_db' does not exist"
Fix: Check if database name is correct in .env file

Error: "role 'fyp_user' does not exist"
Fix: Check if username is correct in .env file

Error: "password authentication failed"
Fix: Check if password matches .env file exactly

Error: "type 'employee_documents_document_type_enum' does not exist"
Fix: The enum might have a different name. Check with:
  PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db -c "\dT+"


ğŸ’¡ ALTERNATIVE: Copy-Paste Method
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
If the file method doesn't work, you can run the commands individually:

PGPASSWORD='GL5jYNDqsOVkx6tIfIS2eUonM' psql -U fyp_user -d fyp_db

Then paste one by one:

ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'EMPLOYMENT_AGREEMENT';

(wait for success message)

ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'CERTIFICATION';

(wait for success message)

ALTER TYPE employee_documents_document_type_enum ADD VALUE IF NOT EXISTS 'PERFORMANCE_REVIEW';

(wait for success message)

\q


ğŸ¯ SUCCESS INDICATORS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Migration runs without errors
âœ… Enum verification shows 8 values (not 5)
âœ… Backend builds successfully
âœ… Backend restarts without errors
âœ… Test upload with "Certification" succeeds
âœ… Backend logs show "Document saved successfully"


â±ï¸ ESTIMATED TIME
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Pull code:       30 seconds
Run migration:   10 seconds
Verify:          10 seconds
Rebuild:         2 minutes
Restart:         10 seconds
Test:            1 minute
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:           ~4 minutes


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Key Point: Use fyp_user and fyp_db (not postgres and fyp_system!)       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
