(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[614],{9161:function(e,t,s){Promise.resolve().then(s.bind(s,5796))},5796:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m},dynamic:function(){return h}});var a=s(7437),r=s(2265),o=s(9376),l=s(575),n=s(9116),i=s(8068),d=s(4226),c=s(1154),u=e=>{let{title:t,value:s,icon:r,trend:o,className:l="",variant:n="blue"}=e,i={blue:"from-blue-500 to-indigo-600",green:"from-green-500 to-emerald-600",purple:"from-purple-500 to-pink-600",orange:"from-orange-500 to-red-600",red:"from-red-500 to-rose-600"};return(0,a.jsxs)("div",{className:"relative overflow-hidden bg-white rounded-2xl shadow-xl p-6 hover:shadow-2xl transition-all duration-300 transform hover:scale-[1.02] ".concat(l),children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ".concat(i[n]," opacity-10 rounded-bl-full")}),(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600 uppercase tracking-wide mb-1",children:t}),(0,a.jsx)("h3",{className:"text-3xl font-bold text-gray-900",children:s})]}),r&&(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br ".concat(i[n]," rounded-xl flex items-center justify-center shadow-lg"),children:r})]}),o&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[o.isPositive?(0,a.jsx)("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}):(0,a.jsx)("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 17h8m0 0v-8m0 8l-8-8-4 4-6-6"})}),(0,a.jsx)("span",{className:"text-sm font-semibold ".concat(o.isPositive?"text-green-600":"text-red-600"),children:o.value}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"vs last month"})]})]})]})};let x=e=>{let{children:t,className:s="",variant:r="default",hover:o=!1}=e;return(0,a.jsx)("div",{className:"rounded-xl p-6 ".concat({default:"bg-white dark:bg-gray-900 shadow-lg",gradient:"bg-gradient-to-br from-white to-blue-50 dark:from-gray-900 dark:to-blue-950 shadow-xl",glass:"bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-2xl border border-white/20",outline:"bg-transparent border-2 border-gray-200 dark:border-gray-700 shadow-none"}[r]," ").concat(o?"hover:shadow-2xl hover:scale-[1.02] transition-all duration-300 transform":""," ").concat(s),children:t})},h="force-dynamic";function m(){var e;let{user:t,logout:s}=(0,l.a)(),h=(0,o.useRouter)(),[m,p]=(0,r.useState)(null),[g,v]=(0,r.useState)([]),[f,b]=(0,r.useState)(!0),[j,w]=(0,r.useState)(null),[y,N]=(0,r.useState)(""),[k,_]=(0,r.useState)(""),[D,S]=(0,r.useState)("sales_department"),[C,L]=(0,r.useState)(null),[A,Z]=(0,r.useState)({}),[P,O]=(0,r.useState)([]),[F,R]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(t){if("super_admin"!==t.role){h.replace("/dashboard");return}(async()=>{var e,t,a,r,o,l;try{b(!0);let[s,a,r]=await Promise.all([n.Z.get("/users/count"),n.Z.get("/users"),n.Z.get("/accountant-files")]);p(s.data),v(a.data.users),O(null!==(t=null===(e=r.data)||void 0===e?void 0:e.files)&&void 0!==t?t:[]),R(null)}catch(e){w((null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||"Failed to load data"),((null===(o=e.response)||void 0===o?void 0:o.status)===401||(null===(l=e.response)||void 0===l?void 0:l.status)===403)&&s()}finally{b(!1)}})()}},[t,h,s]);let T=async()=>{var e,t,s,a;let[r,o]=await Promise.all([n.Z.get("/users/count"),n.Z.get("/users")]);p(r.data),v(o.data.users);try{let s=await n.Z.get("/accountant-files");O(null!==(t=null===(e=s.data)||void 0===e?void 0:e.files)&&void 0!==t?t:[])}catch(e){R((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to load accountant files")}},E=async e=>{e.preventDefault(),L(null);try{await n.Z.post("/users/create",{email:y,password:k,role:D}),L("User created successfully"),N(""),_(""),await T()}catch(e){var t,s;L((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to create user")}},I=async e=>{try{let t=A[e];if(!t)return;await n.Z.post("/users/suspend",{id:e,until:t}),await T()}catch(e){var t,s;alert((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to suspend user")}},U=async e=>{try{await n.Z.post("/users/suspend",{id:e}),await T()}catch(e){var t,s;alert((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to clear suspension")}},M=async(e,t)=>{if(confirm("Delete user ".concat(t,"? This cannot be undone.")))try{await n.Z.post("/users/delete",{id:e}),await T()}catch(e){var s,a;alert((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to delete user")}},z=async(e,t)=>{try{let s=await n.Z.get("/accountant-files/".concat(e),{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([s.data])),r=document.createElement("a");r.href=a,r.download=t,r.click(),window.URL.revokeObjectURL(a)}catch(e){var a,r,o,l;alert((null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||"Download failed"),((null===(o=e.response)||void 0===o?void 0:o.status)===401||(null===(l=e.response)||void 0===l?void 0:l.status)===403)&&s()}},q=g.filter(e=>!!e.last_login_at&&(Date.now()-new Date(e.last_login_at).getTime())/864e5<=7).length,B=g.filter(e=>e.account_locked_until&&new Date(e.account_locked_until)>new Date).length;return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl border border-white/20 p-6 mb-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-2",children:"Super Admin Dashboard"}),(0,a.jsxs)("p",{className:"text-gray-600 flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83D\uDC64"}),(0,a.jsx)("span",{children:null==t?void 0:t.email}),(0,a.jsx)("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-700 rounded-lg text-xs font-semibold",children:"SUPER ADMIN"})]})]}),(0,a.jsx)(d.Z,{onClick:s,variant:"danger",children:(0,a.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"Logout"}),(0,a.jsx)("span",{children:"\uD83D\uDEAA"})]})})]})}),f?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,a.jsx)(c.Z,{}),(0,a.jsx)("p",{className:"text-gray-600 mt-4 text-lg font-medium",children:"Loading dashboard..."})]}):j?(0,a.jsxs)(x,{variant:"glass",className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-red-600 text-lg font-semibold mb-2",children:"⚠️ Error"}),(0,a.jsx)("div",{className:"text-gray-700",children:j})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)(u,{title:"Total Users",value:null!==(e=null==m?void 0:m.total)&&void 0!==e?e:0,variant:"blue",icon:(0,a.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),(0,a.jsx)(u,{title:"Recent Logins",value:q,variant:"green",icon:(0,a.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),trend:{value:"".concat(q," this week"),isPositive:!0}}),(0,a.jsx)(u,{title:"Suspended Users",value:B,variant:"orange",icon:(0,a.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,a.jsx)(u,{title:"Accountant Files",value:P.length,variant:"purple",icon:(0,a.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]}),(0,a.jsxs)(x,{variant:"gradient",className:"mb-8",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-6 flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[(0,a.jsx)("span",{className:"text-2xl",children:"➕"}),(0,a.jsx)("span",{children:"Create New User"})]}),C&&(0,a.jsx)("div",{className:"mb-4 px-4 py-3 rounded-xl font-medium ".concat(C.includes("successfully")?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:C}),(0,a.jsxs)("form",{onSubmit:E,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(i.Z,{type:"email",placeholder:"Email",value:y,onChange:e=>N(e.target.value),required:!0}),(0,a.jsx)(i.Z,{type:"password",placeholder:"Temp Password",value:k,onChange:e=>_(e.target.value),required:!0}),(0,a.jsxs)("select",{className:"border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20 transition-all",value:D,onChange:e=>S(e.target.value),children:[(0,a.jsx)("option",{value:"sales_department",children:"Sales"}),(0,a.jsx)("option",{value:"human_resources",children:"HR"}),(0,a.jsx)("option",{value:"marketing",children:"Marketing"}),(0,a.jsx)("option",{value:"accountant",children:"Accountant"}),(0,a.jsx)("option",{value:"super_admin",children:"Super Admin"})]}),(0,a.jsx)(d.Z,{type:"submit",variant:"success",children:(0,a.jsxs)("span",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("span",{children:"Create User"}),(0,a.jsx)("span",{children:"✨"})]})})]})]}),(0,a.jsxs)(x,{variant:"gradient",className:"mb-8",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-6 flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC65"}),(0,a.jsx)("span",{children:"User Management"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b-2 border-white/20",children:[(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Email"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Role"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Last Login"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Created"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Status"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:g.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b border-white/10 hover:bg-white/10 transition-colors",children:[(0,a.jsx)("td",{className:"py-3 px-4 font-semibold text-white",children:e.email}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-lg text-sm font-bold capitalize",children:null===(t=e.role)||void 0===t?void 0:t.replace("_"," ")})}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm font-medium text-white",children:e.last_login_at?new Date(e.last_login_at).toLocaleDateString():"-"}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm font-medium text-white",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.account_locked_until&&new Date(e.account_locked_until)>new Date?(0,a.jsx)("span",{className:"px-3 py-1 bg-red-100 text-red-800 rounded-lg text-sm font-bold",children:"Suspended"}):(0,a.jsx)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-lg text-sm font-bold",children:"Active"})}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("input",{type:"datetime-local",className:"border-2 border-gray-200 rounded-lg px-2 py-1 text-sm focus:outline-none focus:border-blue-500",value:A[e.id]||"",onChange:t=>Z(s=>({...s,[e.id]:t.target.value}))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>I(e.id),className:"px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium transition-colors",children:"Suspend"}),(0,a.jsx)("button",{onClick:()=>U(e.id),className:"px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors",children:"Clear"}),(0,a.jsx)("button",{onClick:()=>M(e.id,e.email),className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors",children:"Delete"})]})]})})]},e.id)})})]})})]}),(0,a.jsxs)(x,{variant:"gradient",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCC1"}),(0,a.jsx)("span",{children:"Accountant Files"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d.Z,{onClick:()=>h.push("/dashboard/accountant"),variant:"secondary",children:"Open Accountant Dashboard"}),(0,a.jsx)(d.Z,{onClick:async()=>{var e,t,s,a;try{let s=await n.Z.get("/accountant-files");O(null!==(t=null===(e=s.data)||void 0===e?void 0:e.files)&&void 0!==t?t:[]),R(null)}catch(e){R((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to refresh files")}},variant:"outline",children:"\uD83D\uDD04 Refresh"})]})]}),F&&(0,a.jsx)("div",{className:"mb-4 px-4 py-3 rounded-xl bg-red-100 text-red-800 border border-red-200 font-medium",children:F}),(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b-2 border-white/20",children:[(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Filename"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Type"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Size"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Uploaded"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-bold text-white",children:"Action"})]})}),(0,a.jsx)("tbody",{children:P.map(e=>(0,a.jsxs)("tr",{className:"border-b border-white/10 hover:bg-white/10 transition-colors",children:[(0,a.jsx)("td",{className:"py-3 px-4 font-semibold text-white",children:e.filename}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm font-medium text-white",children:e.mimetype}),(0,a.jsxs)("td",{className:"py-3 px-4 text-sm font-medium text-white",children:[(e.size/1024).toFixed(1)," KB"]}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm font-medium text-white",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("button",{onClick:()=>z(e.id,e.filename),className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-medium transition-all transform hover:scale-105",children:"\uD83D\uDCE5 Download"})})]},e.id))})]}),0===P.length&&(0,a.jsxs)("div",{className:"py-12 text-center text-gray-500",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCC2"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"No files uploaded yet"})]})]})]})]})]})})}},4226:function(e,t,s){"use strict";var a=s(7437);s(2265),t.Z=e=>{let{className:t="",variant:s="primary",children:r,...o}=e;return(0,a.jsx)("button",{className:"\n        ".concat({primary:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/50 hover:shadow-blue-600/50",secondary:"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white shadow-lg shadow-gray-500/50",danger:"bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white shadow-lg shadow-red-500/50",success:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg shadow-green-500/50",outline:"bg-transparent border-2 border-blue-600 text-blue-600 hover:bg-blue-50 shadow-none"}[s],"\n        rounded-xl px-6 py-3 w-full font-semibold\n        transition-all duration-300 \n        transform hover:scale-[1.02] active:scale-[0.98]\n        disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\n        focus:outline-none focus:ring-4 focus:ring-blue-500/50\n        ").concat(t,"\n      "),...o,children:r})}},8068:function(e,t,s){"use strict";var a=s(7437);s(2265),t.Z=e=>{let{className:t="",label:s,error:r,icon:o,labelClassName:l,...n}=e;return(0,a.jsxs)("div",{className:"w-full",children:[s&&(0,a.jsx)("label",{className:l||"block text-sm font-semibold text-gray-700 mb-2",children:s}),(0,a.jsxs)("div",{className:"relative",children:[o&&(0,a.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",children:o}),(0,a.jsx)("input",{className:"\n            bg-white border-2 border-gray-200 text-gray-900 \n            rounded-xl px-4 py-3 w-full\n            ".concat(o?"pl-12":"","\n            focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20\n            hover:border-gray-300\n            transition-all duration-300\n            placeholder:text-gray-400\n            disabled:bg-gray-50 disabled:cursor-not-allowed\n            ").concat(r?"border-red-500 focus:border-red-500 focus:ring-red-500/20":"","\n            ").concat(t,"\n          "),...n})]}),r&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600 font-medium",children:r})]})}},1154:function(e,t,s){"use strict";var a=s(7437);s(2265),t.Z=function(){return(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"})})}},575:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return i},a:function(){return d}});var a=s(7437),r=s(2265),o=s(9116),l=s(9376);let n=(0,r.createContext)(void 0),i=e=>{let{children:t}=e,[s,i]=(0,r.useState)(null),[d,c]=(0,r.useState)(null),[u,x]=(0,r.useState)(!1),[h,m]=(0,r.useState)(null),p=(0,l.useRouter)();(0,r.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&i(e),t&&c(JSON.parse(t))},[]);let g=async(e,t)=>{x(!0),m(null);let s=e.trim();try{let e=await o.Z.post("/auth/login",{email:s,password:t});if(e.data.requiresOtp)return{requiresOtp:!0};if(e.data.access_token&&e.data.user)return i(e.data.access_token),c(e.data.user),localStorage.setItem("token",e.data.access_token),localStorage.setItem("user",JSON.stringify(e.data.user)),{access_token:e.data.access_token,user:e.data.user};return m("Invalid response from server."),{}}catch(e){var a,r,l,n,d,u,h,p,g,v,f,b;if(console.log("[Auth] Login error status:",null===(a=e.response)||void 0===a?void 0:a.status),console.log("[Auth] Login error data:",null===(r=e.response)||void 0===r?void 0:r.data),(null===(n=e.response)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:l.locked)===!0&&(null===(u=e.response)||void 0===u?void 0:null===(d=u.data)||void 0===d?void 0:d.email))return console.log("[Auth] OTP required (account locked)"),{requiresOtp:!0,email:e.response.data.email};if((null===(p=e.response)||void 0===p?void 0:null===(h=p.data)||void 0===h?void 0:h.suspended)===!0)return m((null===(b=e.response)||void 0===b?void 0:null===(f=b.data)||void 0===f?void 0:f.message)||"Your account has been suspended. Please contact an administrator."),{};return m((null===(v=e.response)||void 0===v?void 0:null===(g=v.data)||void 0===g?void 0:g.message)||"Login failed"),{}}finally{x(!1)}},v=async e=>{x(!0),m(null),console.log("[Auth] Requesting OTP for forgot password:",e);try{let t=await o.Z.post("/auth/forgot-password",{email:e});return console.log("[Auth] Forgot password response:",t.data),!0}catch(e){var t,s;return m((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to request password reset OTP"),console.error("[Auth] Forgot password error:",e),!1}finally{x(!1)}},f=async(e,t)=>{x(!0),m(null),console.log("[Auth] Attempting OTP verification for email:",e);try{let s=await o.Z.post("/auth/verify-otp",{email:e,otp:t});if(console.log("[Auth] Response from /auth/verify-otp:",s.data),s.data.otp_reset)return console.log("[Auth] OTP verified, got otp_reset:",s.data.otp_reset),{otp_reset:s.data.otp_reset,type:"reset"};if(s.data.access_token&&s.data.user)return i(s.data.access_token),c(s.data.user),localStorage.setItem("token",s.data.access_token),localStorage.setItem("user",JSON.stringify(s.data.user)),{access_token:s.data.access_token,user:s.data.user,type:"mfa"};return m("Invalid OTP or response."),!1}catch(e){var s,a;return m((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"OTP verification failed"),!1}finally{x(!1)}},b=async(e,t,s,a)=>{x(!0),m(null);try{let r=await o.Z.post("/auth/reset-password",{email:e,otp_reset:t,newPassword:s,confirmPassword:a});return console.log("[Auth] Password reset response:",r.data),!0}catch(e){var r,l;return m((null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)||"Password reset failed"),console.error("[Auth] Password reset error:",e),!1}finally{x(!1)}};return(0,a.jsx)(n.Provider,{value:{token:s,user:d,loading:u,error:h,login:g,forgotPassword:v,verifyOtp:f,logout:()=>{console.log("[Auth] Logging out user"),i(null),c(null),localStorage.removeItem("token"),localStorage.removeItem("user"),p.push("/login")},resetPassword:b},children:t})},d=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9116:function(e,t,s){"use strict";let a=s(3464).Z.create({baseURL:"http://47.128.68.111:3000",withCredentials:!0,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t))}catch(e){console.warn("[API] Failed to read token from localStorage:",e)}return e}),a.interceptors.response.use(e=>e,e=>Promise.reject(e)),t.Z=a}},function(e){e.O(0,[301,971,117,744],function(){return e(e.s=9161)}),_N_E=e.O()}]);