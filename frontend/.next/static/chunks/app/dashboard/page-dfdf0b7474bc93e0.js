(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{9032:function(e,t,r){Promise.resolve().then(r.bind(r,1720))},1720:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u},dynamic:function(){return d}});var o=r(7437),a=r(2265),s=r(575),n=r(4226),l=r(1154),i=r(9376);let d="force-dynamic";function u(){let{user:e,logout:t,loading:r}=(0,s.a)(),d=(0,i.useRouter)();return(a.useEffect(()=>{r||(e?"super_admin"===e.role?d.replace("/dashboard/superadmin"):"accountant"===e.role&&d.replace("/dashboard/accountant"):d.replace("/login"))},[e,r,d]),r||!e)?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)(l.Z,{}),(0,o.jsx)("p",{className:"text-white mt-4 text-lg font-medium",children:"Loading your workspace..."})]})}):(0,o.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 relative overflow-hidden",children:[(0,o.jsxs)("div",{className:"absolute inset-0",children:[(0,o.jsx)("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl animate-pulse"}),(0,o.jsx)("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-indigo-500/20 rounded-full blur-3xl animate-pulse delay-1000"})]}),(0,o.jsxs)("div",{className:"relative z-10 bg-white/10 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 p-10 w-full max-w-md text-center",children:[(0,o.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl mb-6 shadow-lg",children:(0,o.jsx)("span",{className:"text-4xl",children:"\uD83D\uDC4B"})}),(0,o.jsx)("h2",{className:"text-3xl font-bold mb-2 text-white",children:"Welcome!"}),(0,o.jsx)("p",{className:"text-blue-200 mb-8 text-lg",children:null==e?void 0:e.email}),(0,o.jsx)(n.Z,{onClick:t,variant:"danger",className:"w-full",children:(0,o.jsxs)("span",{className:"flex items-center justify-center space-x-2",children:[(0,o.jsx)("span",{children:"Logout"}),(0,o.jsx)("span",{children:"\uD83D\uDEAA"})]})})]})]})}},4226:function(e,t,r){"use strict";var o=r(7437);r(2265),t.Z=e=>{let{className:t="",variant:r="primary",children:a,...s}=e;return(0,o.jsx)("button",{className:"\n        ".concat({primary:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/50 hover:shadow-blue-600/50",secondary:"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white shadow-lg shadow-gray-500/50",danger:"bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white shadow-lg shadow-red-500/50",success:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg shadow-green-500/50",outline:"bg-transparent border-2 border-blue-600 text-blue-600 hover:bg-blue-50 shadow-none"}[r],"\n        rounded-xl px-6 py-3 w-full font-semibold\n        transition-all duration-300 \n        transform hover:scale-[1.02] active:scale-[0.98]\n        disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\n        focus:outline-none focus:ring-4 focus:ring-blue-500/50\n        ").concat(t,"\n      "),...s,children:a})}},1154:function(e,t,r){"use strict";var o=r(7437);r(2265),t.Z=function(){return(0,o.jsx)("div",{className:"flex justify-center items-center",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"})})}},575:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return i},a:function(){return d}});var o=r(7437),a=r(2265),s=r(9116),n=r(9376);let l=(0,a.createContext)(void 0),i=e=>{let{children:t}=e,[r,i]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[c,h]=(0,a.useState)(!1),[g,m]=(0,a.useState)(null),v=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&i(e),t&&u(JSON.parse(t))},[]);let f=async(e,t)=>{h(!0),m(null);let r=e.trim();try{let e=await s.Z.post("/auth/login",{email:r,password:t});if(e.data.requiresOtp)return{requiresOtp:!0};if(e.data.access_token&&e.data.user)return i(e.data.access_token),u(e.data.user),localStorage.setItem("token",e.data.access_token),localStorage.setItem("user",JSON.stringify(e.data.user)),{access_token:e.data.access_token,user:e.data.user};return m("Invalid response from server."),{}}catch(e){var o,a,n,l,d,c,g,v,f,p,b,x;if(console.log("[Auth] Login error status:",null===(o=e.response)||void 0===o?void 0:o.status),console.log("[Auth] Login error data:",null===(a=e.response)||void 0===a?void 0:a.data),(null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.locked)===!0&&(null===(c=e.response)||void 0===c?void 0:null===(d=c.data)||void 0===d?void 0:d.email))return console.log("[Auth] OTP required (account locked)"),{requiresOtp:!0,email:e.response.data.email};if((null===(v=e.response)||void 0===v?void 0:null===(g=v.data)||void 0===g?void 0:g.suspended)===!0)return m((null===(x=e.response)||void 0===x?void 0:null===(b=x.data)||void 0===b?void 0:b.message)||"Your account has been suspended. Please contact an administrator."),{};return m((null===(p=e.response)||void 0===p?void 0:null===(f=p.data)||void 0===f?void 0:f.message)||"Login failed"),{}}finally{h(!1)}},p=async e=>{h(!0),m(null),console.log("[Auth] Requesting OTP for forgot password:",e);try{let t=await s.Z.post("/auth/forgot-password",{email:e});return console.log("[Auth] Forgot password response:",t.data),!0}catch(e){var t,r;return m((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"Failed to request password reset OTP"),console.error("[Auth] Forgot password error:",e),!1}finally{h(!1)}},b=async(e,t)=>{h(!0),m(null),console.log("[Auth] Attempting OTP verification for email:",e);try{let r=await s.Z.post("/auth/verify-otp",{email:e,otp:t});if(console.log("[Auth] Response from /auth/verify-otp:",r.data),r.data.otp_reset)return console.log("[Auth] OTP verified, got otp_reset:",r.data.otp_reset),{otp_reset:r.data.otp_reset,type:"reset"};if(r.data.access_token&&r.data.user)return i(r.data.access_token),u(r.data.user),localStorage.setItem("token",r.data.access_token),localStorage.setItem("user",JSON.stringify(r.data.user)),{access_token:r.data.access_token,user:r.data.user,type:"mfa"};return m("Invalid OTP or response."),!1}catch(e){var r,o;return m((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"OTP verification failed"),!1}finally{h(!1)}},x=async(e,t,r,o)=>{h(!0),m(null);try{let a=await s.Z.post("/auth/reset-password",{email:e,otp_reset:t,newPassword:r,confirmPassword:o});return console.log("[Auth] Password reset response:",a.data),!0}catch(e){var a,n;return m((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Password reset failed"),console.error("[Auth] Password reset error:",e),!1}finally{h(!1)}};return(0,o.jsx)(l.Provider,{value:{token:r,user:d,loading:c,error:g,login:f,forgotPassword:p,verifyOtp:b,logout:()=>{console.log("[Auth] Logging out user"),i(null),u(null),localStorage.removeItem("token"),localStorage.removeItem("user"),v.push("/login")},resetPassword:x},children:t})},d=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9116:function(e,t,r){"use strict";let o=r(3464).Z.create({baseURL:"http://47.128.68.111:3000",withCredentials:!0,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t))}catch(e){console.warn("[API] Failed to read token from localStorage:",e)}return e}),o.interceptors.response.use(e=>e,e=>Promise.reject(e)),t.Z=o}},function(e){e.O(0,[301,971,117,744],function(){return e(e.s=9032)}),_N_E=e.O()}]);