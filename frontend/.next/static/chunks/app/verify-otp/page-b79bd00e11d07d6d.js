(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[162],{4603:function(e,t,r){Promise.resolve().then(r.bind(r,9394))},9394:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m},dynamic:function(){return u}});var o=r(7437),a=r(2265),s=r(9376),n=r(575),l=r(8068),i=r(4226),d=r(1154);let u="force-dynamic";function c(){let{verifyOtp:e,loading:t,error:r}=(0,n.a)(),u=(0,s.useSearchParams)(),c=(0,s.useRouter)(),m=u.get("email")||"",g=u.get("flow")||"mfa",[f,h]=(0,a.useState)(""),[v,p]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),x=async t=>{t.preventDefault(),y(null),p(!0);let r=await e(m,f);console.log("[VerifyOtpPage] Result from verifyOtp:",r),p(!1),r&&"reset"===r.type?c.push("/reset-password?email=".concat(encodeURIComponent(m),"&otp_reset=").concat(encodeURIComponent(r.otp_reset||""))):r&&"mfa"===r.type?c.push("/dashboard"):y("Invalid OTP or failed to generate reset OTP.")};return(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,o.jsxs)("form",{onSubmit:x,className:"bg-white p-8 rounded-lg shadow w-full max-w-md",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Enter OTP"}),(0,o.jsx)("p",{className:"text-gray-600 mb-6 text-sm",children:"forgot"===g?"We've sent an OTP to your email. Please enter it below to reset your password.":"lockout"===g?"Your account has been locked. We've sent an OTP to your email. Enter it below to unlock your account and reset your password.":"An OTP has been sent to your email to complete login. Please enter it below."}),b&&(0,o.jsx)("div",{className:"text-red-500 mb-4 text-sm",children:b}),r&&(0,o.jsx)("div",{className:"text-red-500 mb-4 text-sm",children:r}),(0,o.jsx)(l.Z,{type:"text",placeholder:"Enter OTP",value:f,onChange:e=>h(e.target.value),required:!0,className:"mb-4"}),(0,o.jsx)(i.Z,{type:"submit",disabled:v||t,className:"w-full",children:v||t?(0,o.jsx)(d.Z,{}):"Verify OTP"}),(0,o.jsx)("div",{className:"mt-4 text-center",children:(0,o.jsx)("a",{href:"/login",className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Back to Login"})})]})})}function m(){return(0,o.jsx)(a.Suspense,{fallback:(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,o.jsx)(d.Z,{})}),children:(0,o.jsx)(c,{})})}},4226:function(e,t,r){"use strict";var o=r(7437);r(2265),t.Z=e=>{let{className:t="",variant:r="primary",children:a,...s}=e;return(0,o.jsx)("button",{className:"\n        ".concat({primary:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/50 hover:shadow-blue-600/50",secondary:"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white shadow-lg shadow-gray-500/50",danger:"bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white shadow-lg shadow-red-500/50",success:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-lg shadow-green-500/50",outline:"bg-transparent border-2 border-blue-600 text-blue-600 hover:bg-blue-50 shadow-none"}[r],"\n        rounded-xl px-6 py-3 w-full font-semibold\n        transition-all duration-300 \n        transform hover:scale-[1.02] active:scale-[0.98]\n        disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\n        focus:outline-none focus:ring-4 focus:ring-blue-500/50\n        ").concat(t,"\n      "),...s,children:a})}},8068:function(e,t,r){"use strict";var o=r(7437);r(2265),t.Z=e=>{let{className:t="",label:r,error:a,icon:s,labelClassName:n,...l}=e;return(0,o.jsxs)("div",{className:"w-full",children:[r&&(0,o.jsx)("label",{className:n||"block text-sm font-semibold text-gray-700 mb-2",children:r}),(0,o.jsxs)("div",{className:"relative",children:[s&&(0,o.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",children:s}),(0,o.jsx)("input",{className:"\n            bg-white border-2 border-gray-200 text-gray-900 \n            rounded-xl px-4 py-3 w-full\n            ".concat(s?"pl-12":"","\n            focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20\n            hover:border-gray-300\n            transition-all duration-300\n            placeholder:text-gray-400\n            disabled:bg-gray-50 disabled:cursor-not-allowed\n            ").concat(a?"border-red-500 focus:border-red-500 focus:ring-red-500/20":"","\n            ").concat(t,"\n          "),...l})]}),a&&(0,o.jsx)("p",{className:"mt-1 text-sm text-red-600 font-medium",children:a})]})}},1154:function(e,t,r){"use strict";var o=r(7437);r(2265),t.Z=function(){return(0,o.jsx)("div",{className:"flex justify-center items-center",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"})})}},575:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return i},a:function(){return d}});var o=r(7437),a=r(2265),s=r(9116),n=r(9376);let l=(0,a.createContext)(void 0),i=e=>{let{children:t}=e,[r,i]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[c,m]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),h=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&i(e),t&&u(JSON.parse(t))},[]);let v=async(e,t)=>{m(!0),f(null);let r=e.trim();try{let e=await s.Z.post("/auth/login",{email:r,password:t});if(e.data.requiresOtp)return{requiresOtp:!0};if(e.data.access_token&&e.data.user)return i(e.data.access_token),u(e.data.user),localStorage.setItem("token",e.data.access_token),localStorage.setItem("user",JSON.stringify(e.data.user)),{access_token:e.data.access_token,user:e.data.user};return f("Invalid response from server."),{}}catch(e){var o,a,n,l,d,c,g,h,v,p,b,y;if(console.log("[Auth] Login error status:",null===(o=e.response)||void 0===o?void 0:o.status),console.log("[Auth] Login error data:",null===(a=e.response)||void 0===a?void 0:a.data),(null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.locked)===!0&&(null===(c=e.response)||void 0===c?void 0:null===(d=c.data)||void 0===d?void 0:d.email))return console.log("[Auth] OTP required (account locked)"),{requiresOtp:!0,email:e.response.data.email};if((null===(h=e.response)||void 0===h?void 0:null===(g=h.data)||void 0===g?void 0:g.suspended)===!0)return f((null===(y=e.response)||void 0===y?void 0:null===(b=y.data)||void 0===b?void 0:b.message)||"Your account has been suspended. Please contact an administrator."),{};return f((null===(p=e.response)||void 0===p?void 0:null===(v=p.data)||void 0===v?void 0:v.message)||"Login failed"),{}}finally{m(!1)}},p=async e=>{m(!0),f(null),console.log("[Auth] Requesting OTP for forgot password:",e);try{let t=await s.Z.post("/auth/forgot-password",{email:e});return console.log("[Auth] Forgot password response:",t.data),!0}catch(e){var t,r;return f((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"Failed to request password reset OTP"),console.error("[Auth] Forgot password error:",e),!1}finally{m(!1)}},b=async(e,t)=>{m(!0),f(null),console.log("[Auth] Attempting OTP verification for email:",e);try{let r=await s.Z.post("/auth/verify-otp",{email:e,otp:t});if(console.log("[Auth] Response from /auth/verify-otp:",r.data),r.data.otp_reset)return console.log("[Auth] OTP verified, got otp_reset:",r.data.otp_reset),{otp_reset:r.data.otp_reset,type:"reset"};if(r.data.access_token&&r.data.user)return i(r.data.access_token),u(r.data.user),localStorage.setItem("token",r.data.access_token),localStorage.setItem("user",JSON.stringify(r.data.user)),{access_token:r.data.access_token,user:r.data.user,type:"mfa"};return f("Invalid OTP or response."),!1}catch(e){var r,o;return f((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"OTP verification failed"),!1}finally{m(!1)}},y=async(e,t,r,o)=>{m(!0),f(null);try{let a=await s.Z.post("/auth/reset-password",{email:e,otp_reset:t,newPassword:r,confirmPassword:o});return console.log("[Auth] Password reset response:",a.data),!0}catch(e){var a,n;return f((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||"Password reset failed"),console.error("[Auth] Password reset error:",e),!1}finally{m(!1)}};return(0,o.jsx)(l.Provider,{value:{token:r,user:d,loading:c,error:g,login:v,forgotPassword:p,verifyOtp:b,logout:()=>{console.log("[Auth] Logging out user"),i(null),u(null),localStorage.removeItem("token"),localStorage.removeItem("user"),h.push("/login")},resetPassword:y},children:t})},d=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9116:function(e,t,r){"use strict";let o=r(3464).Z.create({baseURL:"http://47.128.68.111:3000",withCredentials:!0,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{try{let t=localStorage.getItem("token");t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t))}catch(e){console.warn("[API] Failed to read token from localStorage:",e)}return e}),o.interceptors.response.use(e=>e,e=>Promise.reject(e)),t.Z=o}},function(e){e.O(0,[301,971,117,744],function(){return e(e.s=4603)}),_N_E=e.O()}]);