â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ         ğŸ”§ EC2 RESTART - COMPLETE COMMANDS                          â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

ğŸ“‹ PROBLEM: Both backend and frontend showing "errored" status after EC2 restart

ğŸ” COMMON CAUSES:
   - PostgreSQL not running
   - Old PM2 processes stuck in error state
   - .env files missing
   - Build directories missing

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  METHOD 1: AUTOMATED SCRIPT (RECOMMENDED)                           â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

# SSH to EC2
ssh -i "your-key.pem" ubuntu@13.213.52.37

# Pull latest code (includes startup script)
cd /home/ubuntu/fyp_system
git pull origin main

# Make script executable and run
chmod +x ec2-startup.sh
./ec2-startup.sh

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  METHOD 2: MANUAL STEP-BY-STEP                                      â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

# 1. Check and start PostgreSQL
sudo systemctl status postgresql
sudo systemctl start postgresql
sudo systemctl enable postgresql

# 2. Verify database connection
sudo -u postgres psql -d fyp_db -c "SELECT 1;"

# 3. Navigate to project
cd /home/ubuntu/fyp_system

# 4. Stop all errored PM2 processes
pm2 delete all

# 5. Start Backend
cd backend
pm2 start dist/src/main.js --name backend
pm2 logs backend --lines 20

# 6. Start Frontend (in new terminal or background)
cd /home/ubuntu/fyp_system/frontend
pm2 start npm --name frontend -- start
pm2 logs frontend --lines 20

# 7. Check status
pm2 status

# 8. Save PM2 configuration
pm2 save

# 9. Setup PM2 startup (if not already done)
pm2 startup
# (run the command it outputs)
pm2 save

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  TROUBLESHOOTING SPECIFIC ERRORS                                    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

IF BACKEND FAILS:
-----------------
# Check if dist folder exists
ls -la backend/dist/src/main.js

# If missing, rebuild
cd backend
npm run build

# Check .env file
cat backend/.env

# Check database connection
sudo -u postgres psql -d fyp_db -c "\dt"

# View detailed logs
pm2 logs backend --lines 100

# Try running directly (for debugging)
cd backend
node dist/src/main.js

IF FRONTEND FAILS:
------------------
# Check if .next folder exists
ls -la frontend/.next

# If missing, rebuild
cd frontend
npm run build

# Check .env.local
cat frontend/.env.local
# Should NOT have NEXT_PUBLIC_API_BASE_URL or should be empty

# View detailed logs
pm2 logs frontend --lines 100

# Try running directly (for debugging)
cd frontend
npm start

IF POSTGRESQL FAILS:
--------------------
# Check PostgreSQL status
sudo systemctl status postgresql

# Check PostgreSQL logs
sudo tail -50 /var/log/postgresql/postgresql-*.log

# Restart PostgreSQL
sudo systemctl restart postgresql

# Check if listening
sudo netstat -tlnp | grep 5432

# Test connection
sudo -u postgres psql
\l
\c fyp_db
\dt

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  VERIFICATION CHECKLIST                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â–¡ PostgreSQL running: sudo systemctl status postgresql
â–¡ PM2 processes online: pm2 status
â–¡ Backend responding: curl http://localhost:3000
â–¡ Frontend responding: curl http://localhost:3001
â–¡ Can access via browser: http://<EC2-IP>:3000
â–¡ Can login to system
â–¡ Revenue dashboard loads
â–¡ No console errors

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  USEFUL PM2 COMMANDS                                                â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

pm2 status                  # Check all processes
pm2 logs                    # View all logs (live)
pm2 logs backend            # View backend logs only
pm2 logs frontend           # View frontend logs only
pm2 logs --lines 100        # View last 100 lines
pm2 restart all             # Restart all processes
pm2 restart backend         # Restart backend only
pm2 stop all                # Stop all processes
pm2 delete all              # Delete all processes
pm2 monit                   # Real-time monitoring
pm2 save                    # Save current process list
pm2 startup                 # Setup auto-start on boot

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  QUICK HEALTH CHECK                                                 â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

# Run this to check everything
sudo systemctl status postgresql | grep "active"
pm2 status
curl -I http://localhost:3000
curl -I http://localhost:3001
ss -tlnp | grep -E '3000|3001|5432'

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  NUCLEAR OPTION: COMPLETE RESET                                     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

# If nothing else works, do a complete reset:

# 1. Stop and delete all PM2 processes
pm2 delete all
pm2 kill

# 2. Restart PostgreSQL
sudo systemctl restart postgresql

# 3. Navigate to project
cd /home/ubuntu/fyp_system

# 4. Pull latest code
git pull origin main

# 5. Rebuild backend
cd backend
npm install
npm run build

# 6. Rebuild frontend
cd /home/ubuntu/fyp_system/frontend
npm install
npm run build

# 7. Start everything
cd /home/ubuntu/fyp_system/backend
pm2 start dist/src/main.js --name backend

cd /home/ubuntu/fyp_system/frontend
pm2 start npm --name frontend -- start

# 8. Save configuration
pm2 save

# 9. Check status
pm2 status
pm2 logs --lines 50

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  AUTO-START ON REBOOT (SETUP ONCE)                                  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

# Ensure PostgreSQL starts on boot
sudo systemctl enable postgresql

# Ensure PM2 starts on boot
pm2 startup
# Copy and run the command it outputs (starts with sudo)
pm2 save

# Test by rebooting
sudo reboot
# Wait a minute, then SSH back in
ssh -i "your-key.pem" ubuntu@13.213.52.37
pm2 status
# Should show processes running automatically

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  SUPPORT: If still having issues, check:                            â”ƒ
â”ƒ  1. pm2 logs backend --lines 100                                    â”ƒ
â”ƒ  2. pm2 logs frontend --lines 100                                   â”ƒ
â”ƒ  3. sudo tail -100 /var/log/postgresql/postgresql-*.log            â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
